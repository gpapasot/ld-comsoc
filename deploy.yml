name: Deploy Gatsby Site

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install dependencies
        run: yarn install

      - name: Build Gatsby site
        # This is the magic command that fixes the /about redirect
        run: yarn build --prefix-paths

      - name: Deploy to GitHub Pages
        uses: enriikke/gatsby-gh-pages-action@v2.2.0
        with:
          access-token: ${{ secrets.GH_PAT }}
          deploy-branch: gh-pages
          # Use the build we just made, don't let the action build it again
          skip-build: true
